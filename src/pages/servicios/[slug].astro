---
import Layout from "../../layouts/BasicLayout.astro";
import { getCollection } from "astro:content";
import { marked } from "marked";

export async function getStaticPaths() {
  const products = await getCollection("products");
  return products.map((p) => ({ params: { slug: p.data?.slug || p.id } }));
}

const products = await getCollection("products");
const { slug } = Astro.params;

const entry = products.find((p) => (p.data?.slug || p.id) == slug);
if (!entry) throw new Error(`Producto no encontrado: ${slug}`);
const product = entry?.data;
if (!product) throw new Error(`Producto no encontrado o mal formado: ${slug}`);
---

<Layout
  title={`${product.Name} â€” ${product.usd_price ? "$" + product.usd_price : ""}`}
  description={product.SEO?.metaDescription}
>
  <main>
    <section class="py-5 bg-light">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-md-6">
            <img
              src={product.Slides?.[0]?.url || product?.SEO?.socialImage?.url}
              alt={product.Name}
              class="img-fluid rounded shadow"
            />
          </div>
          <div class="col-md-6">
            <h1 class="fw-bold">{product.Name}</h1>
            <p class="lead text-muted">
              {product.SEO?.metaDescription}
            </p>
            <h3 class="text-primary">
              {product.PRICES?.[0]?.Price}
            </h3>
            <div class="my-3">
              <!-- <a class="btn btn-primary btn-lg me-2" href="#">Comprar</a> -->
              <!-- <a class="btn btn-outline-primary btn-lg" href="#">Contactar</a> -->
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="py-5">
      <div class="container">
        <div class="content-blocks">
          <article set:html={marked.parse(product?.Description || "")} />
        </div>
      </div>
    </section>
  </main>
</Layout>
